plugins {
    id 'java'
}

final buildFilename = "mindustry-newhorizons.jar"

group 'sonnicon'

sourceCompatibility = 1.8
sourceSets.main {
    java.srcDir("src/")
    resources.srcDir("assets/")
}

repositories {
    mavenCentral()
    maven { url "https://jitpack.io" }
}

dependencies {
    implementation 'com.github.Anuken.Mindustry:core:v121.4'
}

jar {
    archiveName buildFilename
}

task dexify doLast {
    exec{
        workingDir jar.archiveFile.get().asFile.parent

        def command = ["dx", "--dex", "--min-sdk-version=26", "--output=dexed-$buildFilename", buildFilename]
        if (System.getProperty('os.name').toLowerCase(Locale.ROOT).contains('windows')) {
            commandLine ("cmd", "/c", *command)
        } else {
            commandLine (*command)
        }
    }
}

task buildDex dependsOn "build", "dexify"